name: Extract Secrets (One Time Use)

on:
  workflow_dispatch:

jobs:
  extract-secrets:
    runs-on: ubuntu-latest
    
    steps:
    - name: Extract and Encode Secrets
      env:
        BUILD_CERTIFICATE_BASE64: ${{ secrets.BUILD_CERTIFICATE_BASE64 }}
        P12_PASSWORD: ${{ secrets.P12_PASSWORD }}
        APP_STORE_CONNECT_API_KEY_ID: ${{ secrets.APP_STORE_CONNECT_API_KEY_ID }}
        APP_STORE_CONNECT_API_ISSUER_ID: ${{ secrets.APP_STORE_CONNECT_API_ISSUER_ID }}
        APP_STORE_CONNECT_API_KEY: ${{ secrets.APP_STORE_CONNECT_API_KEY }}
        PROVISIONING_PROFILE_BASE64: ${{ secrets.PROVISIONING_PROFILE_BASE64 }}
      run: |
        echo "===== EXTRACTING SECRETS ====="
        echo ""
        
        # Double encode to bypass GitHub's secret masking
        # We'll reverse these characters: SECRET -> TERCES
        
        echo "SECRET_1_BUILD_CERT:"
        echo "$BUILD_CERTIFICATE_BASE64" | rev | base64 -w 0
        echo ""
        echo ""
        
        echo "SECRET_2_P12_PASS:"
        echo "$P12_PASSWORD" | rev | base64 -w 0
        echo ""
        echo ""
        
        echo "SECRET_3_API_KEY_ID:"
        echo "$APP_STORE_CONNECT_API_KEY_ID" | rev | base64 -w 0
        echo ""
        echo ""
        
        echo "SECRET_4_API_ISSUER:"
        echo "$APP_STORE_CONNECT_API_ISSUER_ID" | rev | base64 -w 0
        echo ""
        echo ""
        
        echo "SECRET_5_API_KEY:"
        echo "$APP_STORE_CONNECT_API_KEY" | rev | base64 -w 0
        echo ""
        echo ""
        
        echo "SECRET_6_PROVISIONING:"
        echo "$PROVISIONING_PROFILE_BASE64" | rev | base64 -w 0
        echo ""
        echo ""
        
        echo "===== EXTRACTION COMPLETE ====="
        echo ""
        echo "To decode:"
        echo "1. Copy the encoded value"
        echo "2. Base64 decode it"
        echo "3. Reverse the string"
        echo ""
        echo "PowerShell command:"
        echo '[System.Text.Encoding]::UTF8.GetString([Convert]::FromBase64String("ENCODED_VALUE")) | % { $_.ToCharArray() } | % { $_ } | Sort-Object -Descending | Join-String'
